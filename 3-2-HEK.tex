\subsection{HEK}\label{ssec:hek}

The Sun is an active star and exhibits a wide range of transient phenomena 
(e.g., flares, radio bursts) on many different time-scales, length-scales, and 
wavelengths. Observations and metadata concerning these phenomena are collected 
in the Heliophysics Event Knowledgebase (HEK) \citep{hek2012}.  Entries are generated both by 
automated algorithms and human observers.  Some of the information in the HEK 
reproduces feature and event data from elsewhere (for example, the \textit{GOES} flare catalogue),
and some is generated by the Solar Dynamics Observatory Feature Finding Team 
\citep{martens2012}.  The advantage of the HEK is it 
provides an homogeneous and well-described interface to a large amount of 
feature and event information of interest to the solar physics community. SunPy 
accesses this information through the \texttt{hek} module.  The \texttt{hek} module makes use of the 
HEK API\footnote{For more information see \url{http://vso.stanford.edu/hekwiki/ApplicationProgrammingInterface}}.

Simple HEK queries consist of start time, an end time, and an event type 
(Listing~\ref{code:hek:simple}). Event types are specified as upper case, 
two letter strings, and these strings are 
identical to the two letter abbreviations found at the HEK website
(\url{http://www.lmsal.com/hek/VOEvent_Spec.html}).

\begin{listing}[H]
\pythoncode{pycode_hek.txt}
\caption{Example usage of the \texttt{hek} module showing a simple HEK search for solar flares
on 2011 August 9.}
\label{code:hek:simple}
\end{listing}

The module \texttt{hek.attrs} contains attributes of the HEK that can be used to
construct HEK queries.  For example, a flare is an attribute of the HEK,
 and so 
\texttt{hek.attrs.EventType("FL")} in Listing~\ref{code:hek:simple}
can be alternatively replaced with \texttt{hek.attrs.FL}. 

HEK attributes differ from VSO attributes (Section \ref{ssec:vso}) in that many 
of them are wrappers that conveniently expose comparisons by overloading Python 
operators. This allows filtering of the HEK entries by the properties of the 
event. As was mentioned above, the HEK stores feature/event metadata obtained 
in different ways, known generally as feature recognition methods (FRMs). 
Example in Listing~\ref{code:hek:frm} filters the results of the previous 
result to return only those events that have the FRM `SSW Latest Events'.  Multiple comparisons can be made by including more comma-separated
conditions on the attributes in the call to the HEK query method.

\begin{listing}[H]
\pythoncode{pycode_hek2.txt}
\caption{An HEK query that returns only those flares that were
  detected by the `SSW Latest Events' feature recognition method.}
\label{code:hek:frm}
\end{listing}

HEK comparisons can be combined using Python's logical operators (e.g., \texttt{and}
and \texttt{or}). This makes complex queries easy to create: Listing \ref{code:hek:or} 
returns flares west of 50 arcseconds or those that have a peak flux above 
1000.0 (the units of the flux are FRM-dependent and are described at the HEK 
website).
\begin{listing}[H]
\pythoncode{pycode_hek3.txt}
\caption{HEK query using the logical \texttt{or} operator.}
\label{code:hek:or}
\end{listing}
All FRMs report the required feature attributes, but the optional attributes 
are FRM dependent.  If a FRM does not have one of the optional attributes, 
\texttt{None} is returned by the \texttt{hek} module. 

The ability to use comparison and logical operators on HEK attributes allows 
the construction of queries of almost arbitrary complexity. 
The results of a HEK query can be used to download the 
corresponding data from the VSO using SunPy's \texttt{H2VClient}, as 
demonstrated in Listing~\ref{code:hek2vso}.
\begin{listing}[H]
\pythoncode{pycode_hek4.txt}
\caption{Code snippet continuing from Listing~\ref{code:hek:or} showing the 
query and download of data from the first HEK result from the VSO.}
\label{code:hek2vso}
\end{listing}