\subsection{VSO}\label{ssec:vso}

The Virtual Solar Observatory (VSO) provides a single, standard query
interface to access solar data from different archives around the world
 \cite{hill2009}.
Data products can be requested for specific instruments or missions, but
can also be requested based on physical parameters of the data product such
as the wavelength range.
In addition to the VSO's primary, web-based interface
(\url{http://virtualsolar.org}), a SOAP (Simple Object Access Protocol)
service is also available.
SunPy's \texttt{vso} module accesses the VSO via the SOAP service using the
\texttt{suds} package.
This module was developed under the ESA's Summer of Code programme of 2011.

Listing~\ref{code:vso_query} shows a number of examples of how to make queries
using the \texttt{vso} module.
Each query is constructed by one or more attributes objects, where each
attribute object is a constraint on a parameter of the data set, such as the
time, instrument, wavelength, or  other properties.
Two attribute objects can be combined with a logical \texttt{or} operation
using the ``$|$'' operator.
All attribute objects provided to the query as keyword arguments are combined
with a logical \texttt{and} operation.

\begin{listing}[h]
\begin{minted}[bgcolor=bg]{pycon}
>>> from sunpy.net import vso
>>> client = vso.VSOClient()
>>> tstart, tend = '2011/6/7 05:30', '2011/6/7 05:45'

Querying a single instrument over a time range
>>> lasco_query = client.query(vso.attrs.Time(tstart, tend),
...                            vso.attrs.Instrument('lasco'))
>>> lasco_query.num_records()
2
>>> lasco_query.show() 
Start time           End time             Source  Instrument  Type
----------           --------             ------  ----------  ----
2011-06-07 05:35:23  2011-06-07 05:35:48  SOHO    LASCO       CORONA
2011-06-07 05:43:09  2011-06-07 05:43:29  SOHO    LASCO       CORONA

Querying multiple instruments/missions over the same time range
>>> instrument_condition = ( vso.attrs.Instrument('lasco') |
...                          vso.attrs.Detector('cor1') )
>>> coronagraphs = client.query(vso.attrs.Time(tstart, tend),
...                             instrument_condition)
>>> coronagraphs.num_records()
30
>>> coronographs.show() 
Start time           End time             Source    Instrument  Type
----------           --------             ------    ----------  ----
2011-06-07 05:35:23  2011-06-07 05:35:48  SOHO      LASCO       CORONA
2011-06-07 05:43:09  2011-06-07 05:43:29  SOHO      LASCO       CORONA
2011-06-07 05:30:00  2011-06-07 05:30:01  STEREO_A  SECCHI      CORONA
...
2011-06-07 05:43:13  2011-06-07 05:43:15  STEREO_B  SECCHI      CORONA
2011-06-07 05:45:00  2011-06-07 05:45:01  STEREO_A  SECCHI      CORONA

Querying two wavelength ranges over the same time range
>>> wavelength_condition = ( vso.attrs.Wave(125, 135) |
...                          vso.attrs.Wave(165, 175) ) # in angstroms
>>> euv = client.query(vso.attrs.Time(tstart, tend),
...                    wavelength_condition)
>>> euv.num_records()
199
>>> euv.show()
Start time           End time             Source    Instrument  Type
----------           --------             ------    ----------  ----
2011-06-07 00:00:00  2011-06-08 00:00:00  SDO       EVE         FULLDISK
...
2011-06-07 05:31:09  2011-06-07 05:31:19  PROBA2    SWAP        FULLSUN
...
2011-06-07 05:45:00  2011-06-07 05:45:01  SDO       AIA         FULLDISK
\end{minted}
\caption{Examples of different VSO queries using attribute objects.}
\label{code:vso_query}
\end{listing}

Listing~\ref{code:vso_down} shows how to download the data using the result
from the query.
One can use the metadata associated with the data sets to specify how the
files will be named locally, such as creating subdirectories based on the
instrument names.

\begin{listing}[h]
\begin{minted}[bgcolor=bg]{pycon}
>>> pathformat = '/data/{instrument}/{detector}/{file}.fits'
>>> results = client.get(coronagraphs, path = pathformat)
\end{minted}
\caption{Example of how to download data using a query result (see
listing~\ref{code:vso_query}).}
\label{code:vso_down}
\end{listing}
